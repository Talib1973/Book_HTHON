"use strict";(globalThis.webpackChunkbook_hthon=globalThis.webpackChunkbook_hthon||[]).push([[648],{5034(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"module-1-ros2/week-5-services-actions","title":"Week 5: ROS 2 Services and Actions","description":"Learning Objectives","source":"@site/docs/module-1-ros2/week-5-services-actions.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/week-5-services-actions","permalink":"/docs/module-1-ros2/week-5-services-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-ros2/week-5-services-actions.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"week-5-services-actions","title":"Week 5: ROS 2 Services and Actions","sidebar_position":4,"keywords":["ROS 2","services","actions","client","server","request","reply","goal","feedback"],"dependencies":["week-3-ros2-architecture","week-4-pub-sub"]},"sidebar":"roboticsSidebar","previous":{"title":"Week 4: ROS 2 Publisher-Subscriber Pattern","permalink":"/docs/module-1-ros2/week-4-pub-sub"},"next":{"title":"Module 2 - Digital Twin (Gazebo & Unity)","permalink":"/docs/module-2-digital-twin/"}}');var r=s(4848),t=s(8453);const l={id:"week-5-services-actions",title:"Week 5: ROS 2 Services and Actions",sidebar_position:4,keywords:["ROS 2","services","actions","client","server","request","reply","goal","feedback"],dependencies:["week-3-ros2-architecture","week-4-pub-sub"]},c="Week 5: ROS 2 Services and Actions",o={},a=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Knowledge",id:"knowledge",level:3},{value:"Software/Hardware",id:"softwarehardware",level:3},{value:"Conceptual Explanation",id:"conceptual-explanation",level:2},{value:"Communication Pattern Comparison",id:"communication-pattern-comparison",level:3},{value:"Services (Request-Reply)",id:"services-request-reply",level:3},{value:"Actions (Goal-Feedback-Result)",id:"actions-goal-feedback-result",level:3},{value:"When to Use Each",id:"when-to-use-each",level:3},{value:"Hands-On Lab",id:"hands-on-lab",level:2},{value:"Task 1: Create Service Server",id:"task-1-create-service-server",level:3},{value:"Step 1: Create Service Definition",id:"step-1-create-service-definition",level:4},{value:"Step 2: Implement Service Server",id:"step-2-implement-service-server",level:4},{value:"Step 3: Implement Service Client",id:"step-3-implement-service-client",level:4},{value:"Step 4: Build and Test",id:"step-4-build-and-test",level:4},{value:"Task 2: Create Action Server",id:"task-2-create-action-server",level:3},{value:"Step 1: Create Action Definition",id:"step-1-create-action-definition",level:4},{value:"Step 2: Implement Action Server",id:"step-2-implement-action-server",level:4},{value:"Step 3: Test Action",id:"step-3-test-action",level:4},{value:"Debugging with ros2cli",id:"debugging-with-ros2cli",level:2},{value:"Service Debugging",id:"service-debugging",level:3},{value:"Action Debugging",id:"action-debugging",level:3},{value:"Common Errors &amp; Fixes",id:"common-errors--fixes",level:2},{value:"Error 1: &quot;Service server not responding&quot;",id:"error-1-service-server-not-responding",level:3},{value:"Error 2: &quot;Action goal rejected&quot;",id:"error-2-action-goal-rejected",level:3},{value:"Error 3: &quot;Timeout waiting for service&quot;",id:"error-3-timeout-waiting-for-service",level:3},{value:"Error 4: &quot;Future never completes&quot;",id:"error-4-future-never-completes",level:3},{value:"External Resources",id:"external-resources",level:2},{value:"Assessment Questions",id:"assessment-questions",level:2},{value:"Further Reading",id:"further-reading",level:2},{value:"Advanced Topics",id:"advanced-topics",level:3},{value:"Real-World Applications",id:"real-world-applications",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"week-5-ros-2-services-and-actions",children:"Week 5: ROS 2 Services and Actions"})}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsx)(n.p,{children:"By the end of this week, you will be able to:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Differentiate"})," between topics, services, and actions based on communication patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Implement"})," service clients and servers for synchronous request-reply operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build"})," action servers with goal handling, feedback, and cancellation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Design"})," robot control systems using appropriate communication primitives"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Handle"})," concurrent service requests and action preemption"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.h3,{id:"knowledge",children:"Knowledge"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Completion of Week 3 (ROS 2 Architecture) and Week 4 (Pub-Sub)"}),"\n",(0,r.jsx)(n.li,{children:"Understanding of asynchronous programming concepts"}),"\n",(0,r.jsx)(n.li,{children:"Familiarity with Python classes and callbacks"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"softwarehardware",children:"Software/Hardware"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ROS 2 Humble workspace from previous weeks"}),"\n",(0,r.jsx)(n.li,{children:"Python 3.10+"}),"\n",(0,r.jsx)(n.li,{children:"ros2cli tools"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"conceptual-explanation",children:"Conceptual Explanation"}),"\n",(0,r.jsx)(n.h3,{id:"communication-pattern-comparison",children:"Communication Pattern Comparison"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Pattern"}),(0,r.jsx)(n.th,{children:"Synchronous"}),(0,r.jsx)(n.th,{children:"Duration"}),(0,r.jsx)(n.th,{children:"Feedback"}),(0,r.jsx)(n.th,{children:"Use Case"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Topic"})}),(0,r.jsx)(n.td,{children:"Asynchronous"}),(0,r.jsx)(n.td,{children:"Continuous"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Sensor streams (camera, LIDAR)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Service"})}),(0,r.jsx)(n.td,{children:"Synchronous"}),(0,r.jsx)(n.td,{children:"Short (less than 1s)"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Configuration queries, simple commands"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Action"})}),(0,r.jsx)(n.td,{children:"Asynchronous"}),(0,r.jsx)(n.td,{children:"Long (over 1s)"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Navigation, manipulation, long tasks"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"services-request-reply",children:"Services (Request-Reply)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Services"})," provide ",(0,r.jsx)(n.strong,{children:"synchronous"}),", ",(0,r.jsx)(n.strong,{children:"one-to-one"}),", ",(0,r.jsx)(n.strong,{children:"blocking"})," communication."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"How It Works"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client"})," sends request to service endpoint"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client blocks"})," waiting for response (or uses async callback)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server"})," processes request (computation, I/O, etc.)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server"})," sends reply back to client"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client receives"})," reply and continues execution"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Characteristics"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Blocking"}),": Client waits for server response (can timeout)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"One-to-one"}),": One client per request (though multiple clients can call same service)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stateless"}),": Each request is independent"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reliable"}),": Built on reliable QoS (TCP-like)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example Use Cases"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Get robot battery level"}),"\n",(0,r.jsx)(n.li,{children:"Compute inverse kinematics"}),"\n",(0,r.jsx)(n.li,{children:"Reset odometry"}),"\n",(0,r.jsx)(n.li,{children:"Trigger emergency stop"}),"\n",(0,r.jsx)(n.li,{children:"Query map dimensions"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"actions-goal-feedback-result",children:"Actions (Goal-Feedback-Result)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Actions"})," provide ",(0,r.jsx)(n.strong,{children:"asynchronous"}),", ",(0,r.jsx)(n.strong,{children:"long-running"})," tasks with ",(0,r.jsx)(n.strong,{children:"progress feedback"})," and ",(0,r.jsx)(n.strong,{children:"cancellation"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"How It Works"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client"}),' sends goal to action server (e.g., "navigate to pose X")']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server"})," accepts/rejects goal"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server"}),' executes goal, periodically sending feedback (e.g., "50% complete")']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client"})," can cancel goal mid-execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Server"})," sends final result when complete (success/failure)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Action Components"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),": Desired end state (e.g., target pose, grasp object)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback"}),": Periodic progress updates (e.g., distance remaining, current gripper force)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Result"}),": Final outcome (success, failure, reason)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example Use Cases"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Navigate to waypoint (feedback: distance remaining, ETA)"}),"\n",(0,r.jsx)(n.li,{children:"Pick and place object (feedback: gripper force, object detected)"}),"\n",(0,r.jsx)(n.li,{children:"Charge battery (feedback: current charge percentage)"}),"\n",(0,r.jsx)(n.li,{children:"Execute trajectory (feedback: current joint positions)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-each",children:"When to Use Each"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use Topics when"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Data streams continuously (sensors, odometry)"}),"\n",(0,r.jsx)(n.li,{children:"Low latency required"}),"\n",(0,r.jsx)(n.li,{children:"Multiple subscribers need same data"}),"\n",(0,r.jsx)(n.li,{children:"Fire-and-forget (no confirmation needed)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use Services when"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Need confirmation of completion"}),"\n",(0,r.jsx)(n.li,{children:"Short operation (less than 1 second)"}),"\n",(0,r.jsx)(n.li,{children:"Request-reply pattern fits naturally"}),"\n",(0,r.jsx)(n.li,{children:"Configuration or status queries"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use Actions when"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Operation takes more than 1 second"}),"\n",(0,r.jsx)(n.li,{children:"Need progress feedback"}),"\n",(0,r.jsx)(n.li,{children:"Cancellation required"}),"\n",(0,r.jsx)(n.li,{children:"Long-running tasks (navigation, manipulation)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"hands-on-lab",children:"Hands-On Lab"}),"\n",(0,r.jsx)(n.h3,{id:"task-1-create-service-server",children:"Task 1: Create Service Server"}),"\n",(0,r.jsx)(n.p,{children:"Implement a service that adds two integers."}),"\n",(0,r.jsx)(n.h4,{id:"step-1-create-service-definition",children:"Step 1: Create Service Definition"}),"\n",(0,r.jsxs)(n.p,{children:["For built-in services, use ",(0,r.jsx)(n.code,{children:"example_interfaces/srv/AddTwoInts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"int64 a\nint64 b\n---\nint64 sum\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-2-implement-service-server",children:"Step 2: Implement Service Server"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="add_two_ints_server.py"',children:'#!/usr/bin/env python3\n"""\nService server that adds two integers.\n\nDemonstrates:\n- Creating a service server\n- Processing requests and sending responses\n- Error handling and logging\n- Service lifecycle management\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\n\nclass AddTwoIntsServer(Node):\n    """Service server that performs integer addition."""\n\n    def __init__(self):\n        """Initialize the service server."""\n        super().__init__(\'add_two_ints_server\')\n\n        # Create service: name=\'/add_two_ints\', type=AddTwoInts, callback=add_two_ints_callback\n        self.srv = self.create_service(\n            AddTwoInts,\n            \'add_two_ints\',\n            self.add_two_ints_callback\n        )\n\n        self.get_logger().info(\'Add Two Ints service ready.\')\n\n    def add_two_ints_callback(self, request, response):\n        """\n        Service callback that processes addition requests.\n\n        Args:\n            request (AddTwoInts.Request): Request object with \'a\' and \'b\' fields\n            response (AddTwoInts.Response): Response object to populate with \'sum\'\n\n        Returns:\n            AddTwoInts.Response: Populated response object\n        """\n        response.sum = request.a + request.b\n\n        self.get_logger().info(\n            f\'Incoming request: a={request.a}, b={request.b} -> sum={response.sum}\'\n        )\n\n        return response\n\n\ndef main(args=None):\n    """Main entry point for service server."""\n    rclpy.init(args=args)\n\n    node = AddTwoIntsServer()\n\n    try:\n        rclpy.spin(node)  # Keep server running\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h4,{id:"step-3-implement-service-client",children:"Step 3: Implement Service Client"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="add_two_ints_client.py"',children:'#!/usr/bin/env python3\n"""\nService client that calls AddTwoInts service.\n\nDemonstrates:\n- Creating a service client\n- Waiting for service availability\n- Sending synchronous requests\n- Handling responses and timeouts\n"""\n\nimport sys\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\n\nclass AddTwoIntsClient(Node):\n    """Service client for adding two integers."""\n\n    def __init__(self):\n        """Initialize the service client."""\n        super().__init__(\'add_two_ints_client\')\n\n        # Create client: service_name=\'/add_two_ints\', service_type=AddTwoInts\n        self.cli = self.create_client(AddTwoInts, \'add_two_ints\')\n\n        # Wait for service to become available (timeout: 1 second)\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info(\'Service not available, waiting...\')\n\n        self.get_logger().info(\'Service available!\')\n\n    def send_request(self, a, b):\n        """\n        Send addition request to service.\n\n        Args:\n            a (int): First integer\n            b (int): Second integer\n\n        Returns:\n            int: Sum of a and b\n        """\n        # Create request object\n        request = AddTwoInts.Request()\n        request.a = a\n        request.b = b\n\n        # Call service (blocking call)\n        future = self.cli.call_async(request)\n\n        # Wait for response\n        rclpy.spin_until_future_complete(self, future)\n\n        if future.result() is not None:\n            response = future.result()\n            self.get_logger().info(f\'Result: {a} + {b} = {response.sum}\')\n            return response.sum\n        else:\n            self.get_logger().error(\'Service call failed\')\n            return None\n\n\ndef main(args=None):\n    """Main entry point for service client."""\n    rclpy.init(args=args)\n\n    # Parse command-line arguments\n    if len(sys.argv) < 3:\n        print(\'Usage: ros2 run minimal_publisher add_two_ints_client <a> <b>\')\n        return\n\n    a = int(sys.argv[1])\n    b = int(sys.argv[2])\n\n    # Create client and send request\n    node = AddTwoIntsClient()\n    node.send_request(a, b)\n\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h4,{id:"step-4-build-and-test",children:"Step 4: Build and Test"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cd ~/ros2_ws\ncolcon build --packages-select minimal_publisher\nsource install/setup.bash\n\n# Terminal 1: Start service server\nros2 run minimal_publisher add_two_ints_server\n\n# Terminal 2: Call service from client\nros2 run minimal_publisher add_two_ints_client 5 7\n\n# Or call service from command line\nros2 service call /add_two_ints example_interfaces/srv/AddTwoInts "{a: 10, b: 20}"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected Output"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Server terminal:\n[INFO] [add_two_ints_server]: Incoming request: a=5, b=7 -> sum=12\n\n# Client terminal:\n[INFO] [add_two_ints_client]: Result: 5 + 7 = 12\n"})}),"\n",(0,r.jsx)(n.h3,{id:"task-2-create-action-server",children:"Task 2: Create Action Server"}),"\n",(0,r.jsx)(n.p,{children:"Implement an action for Fibonacci sequence generation with feedback."}),"\n",(0,r.jsx)(n.h4,{id:"step-1-create-action-definition",children:"Step 1: Create Action Definition"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"action/Fibonacci.action"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Goal: Generate Fibonacci sequence up to order n\nint32 order\n---\n# Result: Complete sequence\nint32[] sequence\n---\n# Feedback: Current partial sequence\nint32[] partial_sequence\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-2-implement-action-server",children:"Step 2: Implement Action Server"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="fibonacci_action_server.py"',children:'#!/usr/bin/env python3\n"""\nAction server that generates Fibonacci sequence.\n\nDemonstrates:\n- Creating an action server\n- Accepting/rejecting goals\n- Sending periodic feedback\n- Handling goal cancellation\n- Returning final result\n"""\n\nimport time\nimport rclpy\nfrom rclpy.node import Node\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\nfrom minimal_publisher.action import Fibonacci\n\n\nclass FibonacciActionServer(Node):\n    """Action server for Fibonacci sequence generation."""\n\n    def __init__(self):\n        """Initialize the action server."""\n        super().__init__(\'fibonacci_action_server\')\n\n        # Create action server\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            \'fibonacci\',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback\n        )\n\n        self.get_logger().info(\'Fibonacci action server ready.\')\n\n    def goal_callback(self, goal_request):\n        """\n        Called when a new goal is received.\n\n        Args:\n            goal_request (Fibonacci.Goal): The goal request\n\n        Returns:\n            GoalResponse: ACCEPT or REJECT\n        """\n        self.get_logger().info(f\'Received goal request: order={goal_request.order}\')\n\n        # Reject negative or excessively large orders\n        if goal_request.order < 0 or goal_request.order > 50:\n            self.get_logger().warn(\'Rejecting goal: invalid order\')\n            return GoalResponse.REJECT\n\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        """\n        Called when a client requests goal cancellation.\n\n        Args:\n            goal_handle: Handle to the goal being cancelled\n\n        Returns:\n            CancelResponse: ACCEPT or REJECT cancellation\n        """\n        self.get_logger().info(\'Received cancellation request\')\n        return CancelResponse.ACCEPT\n\n    def execute_callback(self, goal_handle):\n        """\n        Execute the Fibonacci generation goal.\n\n        Args:\n            goal_handle: Handle to the accepted goal\n\n        Returns:\n            Fibonacci.Result: The final result\n        """\n        self.get_logger().info(\'Executing goal...\')\n\n        # Initialize feedback message\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.partial_sequence = [0, 1]\n\n        # Generate Fibonacci sequence\n        for i in range(1, goal_handle.request.order):\n            # Check if goal was cancelled\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info(\'Goal cancelled\')\n                return Fibonacci.Result()\n\n            # Compute next Fibonacci number\n            next_num = feedback_msg.partial_sequence[i] + feedback_msg.partial_sequence[i - 1]\n            feedback_msg.partial_sequence.append(next_num)\n\n            # Publish feedback\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f\'Feedback: {feedback_msg.partial_sequence}\')\n\n            # Simulate computation time\n            time.sleep(0.5)\n\n        # Goal succeeded\n        goal_handle.succeed()\n\n        # Return final result\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.partial_sequence\n        self.get_logger().info(f\'Returning result: {result.sequence}\')\n\n        return result\n\n\ndef main(args=None):\n    """Main entry point for action server."""\n    rclpy.init(args=args)\n\n    node = FibonacciActionServer()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,r.jsx)(n.h4,{id:"step-3-test-action",children:"Step 3: Test Action"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Terminal 1: Start action server\nros2 run minimal_publisher fibonacci_action_server\n\n# Terminal 2: Send action goal from command line\nros2 action send_goal /fibonacci minimal_publisher/action/Fibonacci "{order: 10}" --feedback\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected Output"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Server terminal:\n[INFO] [fibonacci_action_server]: Feedback: [0, 1, 1]\n[INFO] [fibonacci_action_server]: Feedback: [0, 1, 1, 2]\n[INFO] [fibonacci_action_server]: Feedback: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]\n[INFO] [fibonacci_action_server]: Returning result: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"debugging-with-ros2cli",children:"Debugging with ros2cli"}),"\n",(0,r.jsx)(n.h3,{id:"service-debugging",children:"Service Debugging"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# List all services\nros2 service list\n\n# Get service type\nros2 service type /add_two_ints\n\n# Call service\nros2 service call /add_two_ints example_interfaces/srv/AddTwoInts "{a: 5, b: 3}"\n\n# Find services of a specific type\nros2 service find example_interfaces/srv/AddTwoInts\n'})}),"\n",(0,r.jsx)(n.h3,{id:"action-debugging",children:"Action Debugging"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# List all actions\nros2 action list\n\n# Get action info\nros2 action info /fibonacci\n\n# Send action goal with feedback\nros2 action send_goal /fibonacci minimal_publisher/action/Fibonacci "{order: 5}" --feedback\n'})}),"\n",(0,r.jsx)(n.h2,{id:"common-errors--fixes",children:"Common Errors & Fixes"}),"\n",(0,r.jsx)(n.h3,{id:"error-1-service-server-not-responding",children:'Error 1: "Service server not responding"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Service server node not running or name mismatch."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify server is running\nros2 node list\n\n# Check service exists\nros2 service list\n\n# Verify service name matches client\n"})}),"\n",(0,r.jsx)(n.h3,{id:"error-2-action-goal-rejected",children:'Error 2: "Action goal rejected"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Server's ",(0,r.jsx)(n.code,{children:"goal_callback"})," returned ",(0,r.jsx)(n.code,{children:"GoalResponse.REJECT"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Check server logs for rejection reason (invalid parameters, resource unavailable, etc.)."]}),"\n",(0,r.jsx)(n.h3,{id:"error-3-timeout-waiting-for-service",children:'Error 3: "Timeout waiting for service"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": ",(0,r.jsx)(n.code,{children:"wait_for_service()"})," timeout exceeded."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Increase timeout or ensure server starts before client."]}),"\n",(0,r.jsx)(n.h3,{id:"error-4-future-never-completes",children:'Error 4: "Future never completes"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": ",(0,r.jsx)(n.code,{children:"spin_until_future_complete()"})," never called or executor not spinning."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Always call ",(0,r.jsx)(n.code,{children:"rclpy.spin_until_future_complete(node, future)"})," after ",(0,r.jsx)(n.code,{children:"call_async()"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"external-resources",children:"External Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Services/Understanding-ROS2-Services.html",children:"ROS 2 Services Tutorial"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Actions/Understanding-ROS2-Actions.html",children:"ROS 2 Actions Tutorial"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://design.ros2.org/articles/actions.html",children:"Action Design Guide"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/ros2/example_interfaces",children:"example_interfaces Package"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"assessment-questions",children:"Assessment Questions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What is the main difference between services and topics?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Services are faster"}),"\n",(0,r.jsx)(n.li,{children:"B) Services are synchronous and block the client"}),"\n",(0,r.jsx)(n.li,{children:"C) Services use UDP instead of TCP"}),"\n",(0,r.jsx)(n.li,{children:"D) Services support multiple subscribers"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Answer: B"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When should you use an action instead of a service?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) When you need a response"}),"\n",(0,r.jsx)(n.li,{children:"B) When the operation takes more than 1 second and requires feedback"}),"\n",(0,r.jsx)(n.li,{children:"C) When you need high-frequency communication"}),"\n",(0,r.jsx)(n.li,{children:"D) When multiple clients are involved"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Answer: B"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What are the three components of an action definition?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Request, Response, Feedback"}),"\n",(0,r.jsx)(n.li,{children:"B) Goal, Feedback, Result"}),"\n",(0,r.jsx)(n.li,{children:"C) Input, Output, Status"}),"\n",(0,r.jsx)(n.li,{children:"D) Start, Progress, End"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Answer: B"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Can a service server handle multiple clients simultaneously?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) No, only one client per server"}),"\n",(0,r.jsx)(n.li,{children:"B) Yes, but only with multi-threaded executors"}),"\n",(0,r.jsx)(n.li,{children:"C) Yes, requests are queued and processed sequentially"}),"\n",(0,r.jsx)(n.li,{children:"D) Only if clients use async calls"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Answer: C (by default, single-threaded executor processes requests sequentially)"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What happens if an action client cancels a goal mid-execution?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Server immediately stops without cleanup"}),"\n",(0,r.jsxs)(n.li,{children:["B) Server's ",(0,r.jsx)(n.code,{children:"cancel_callback"})," is invoked, server can accept/reject cancellation"]}),"\n",(0,r.jsx)(n.li,{children:"C) Goal continues to completion"}),"\n",(0,r.jsx)(n.li,{children:"D) ROS 2 throws an error"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Answer: B"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"How does a service client know if the server exists before calling?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Try calling and catch exceptions"}),"\n",(0,r.jsxs)(n.li,{children:["B) Use ",(0,r.jsx)(n.code,{children:"wait_for_service()"})," method"]}),"\n",(0,r.jsxs)(n.li,{children:["C) Check ",(0,r.jsx)(n.code,{children:"ros2 service list"})," manually"]}),"\n",(0,r.jsx)(n.li,{children:"D) Services always exist"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Answer: B"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Explain why navigation would use an action instead of a service."})," (Short answer)"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Expected answer: Navigation takes multiple seconds/minutes to complete, requires continuous feedback (distance remaining, current pose), and may need cancellation if the robot detects an obstacle or the user changes plans. Actions provide goal-feedback-result pattern with cancellation support, which services lack."})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["What does ",(0,r.jsx)(n.code,{children:"rclpy.spin_until_future_complete()"})," do?"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Spins the robot motors"}),"\n",(0,r.jsx)(n.li,{children:"B) Blocks until the async service call completes or times out"}),"\n",(0,r.jsx)(n.li,{children:"C) Publishes to a topic"}),"\n",(0,r.jsx)(n.li,{children:"D) Creates a new thread"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Answer: B"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Can you create multiple service servers with the same service name?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Yes, ROS 2 will load-balance requests"}),"\n",(0,r.jsx)(n.li,{children:"B) No, this causes a name collision error"}),"\n",(0,r.jsx)(n.li,{children:"C) Yes, but only in different namespaces"}),"\n",(0,r.jsx)(n.li,{children:"D) Only if they have different message types"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Answer: C (with different namespaces, e.g., ",(0,r.jsx)(n.code,{children:"/robot1/add_two_ints"})," and ",(0,r.jsx)(n.code,{children:"/robot2/add_two_ints"}),")"]})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Write the service definition for a service that takes a string and returns its length."})," (Short answer)"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Expected answer:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"string input_string\n---\nint32 length\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,r.jsx)(n.h3,{id:"advanced-topics",children:"Advanced Topics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Async Service Calls"}),": Non-blocking service clients with callbacks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-Threaded Executors"}),": Parallel service/action processing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Namespaces and Remapping"}),": Manage multiple robots with same services"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Discovery"}),": Dynamic service lookup and introspection"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"real-world-applications",children:"Real-World Applications"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MoveIt2"}),": Motion planning with action servers for trajectory execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Nav2"}),": Navigation stack with action-based goal sending"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Manipulation"}),": Grasp planning services, gripper control actions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-Robot Systems"}),": Centralized services for fleet coordination"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Congratulations!"})," You've completed Module 1: The Robotic Nervous System (ROS 2)."]}),"\n",(0,r.jsx)(n.p,{children:"You now understand:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 ROS 2 architecture (nodes, DDS, middleware)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Publisher-Subscriber pattern for asynchronous data streams"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Services for synchronous request-reply operations"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Actions for long-running tasks with feedback"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Continue to Module 2: Digital Twin (Gazebo & Unity)"})," to learn how to simulate and test your ROS 2 nodes in realistic physics-based environments before deploying to hardware."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>l,x:()=>c});var i=s(6540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);